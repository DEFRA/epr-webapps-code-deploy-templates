parameters:
  - name: azureSubscription
  - name: serviceName

steps:
  - task: AzureCLI@2
    displayName: 'Current Docker Image Tag ${{ parameters.serviceName }}'
    inputs:
      azureSubscription: ${{ parameters.azureSubscription }}
      scriptType: 'pscore'
      scriptLocation: 'inlineScript'
      inlineScript: |
        Set-StrictMode -Version 3.0

        $serviceName = "${{ parameters.serviceName }}".ToUpper()
        $currentImageTag = ""

        if ($serviceName -match "RWDWEBWA") {            
          $currentImageTag = az webapp list --query "[?name=='$serviceName']" | jq -r '.[].siteConfig.linuxFxVersion'
        } elseif ($serviceName -match "RWDWEBFA") {
          $currentImageTag = az functionapp list --query "[?name=='$serviceName']" | jq -r '.[].siteConfig.linuxFxVersion'
        } else {
          Write-Error "Unknown Service Type"
          exit 1
        }
        Write-Host "Current image: $currentImageTag"
        Write-Host "##vso[task.setvariable variable=currentImageTag;]$currentImageTag"
   